clear all

directoryName = '4Dec_unpacked/2015-12-04-19-58-40';
fileNames = dir(directoryName);
fileNames = {fileNames(3:end).name};

data = struct();

for fileIdx = 1:numel(fileNames)
    fieldName = strrep(fileNames{fileIdx}(1:end-4),'-','_');
    data.(fieldName) = readtable(fullfile(directoryName,fileNames{fileIdx}));
end

setpointTime = data.mavros_setpoint_position_local.Header_secs- min(data.mavros_setpoint_position_local.Header_secs);
poseTime = data.mavros_local_position_local.Header_secs - min(data.mavros_local_position_local.Header_secs);

xsetpoint = data.mavros_setpoint_position_local.Pose_x;
ysetpoint = data.mavros_setpoint_position_local.Pose_y;
zsetpoint = data.mavros_setpoint_position_local.Pose_z;

xpose = data.mavros_local_position_local.Pose_x;
ypose = data.mavros_local_position_local.Pose_y;
zpose = data.mavros_local_position_local.Pose_z;

startPercentage = 0;
endPercentage = .75;

startIdxPose = floor(numel(poseTime) * startPercentage);
endIdxPose = floor(numel(poseTime) * endPercentage);
startIdxSetpoint = floor(numel(setpointTime) * startPercentage);
endIdxSetpoint = floor(numel(setpointTime) * endPercentage);

figure()
plot(poseTime(startIdxPose:endIdxPose),xpose(starIdxPose)) hold on
plot(setpointTime(startIdxSetpoint,endIdxSetpoint),xsetpoint(startIdxSetpoint,endIdxSetpoint))

figure()
plot(poseTime(startIdxPose:endIdxPose),ypose(starIdxPose), hold on
plot(setpointTime(startIdxSetpoint,endIdxSetpoint),ysetpoint(startIdxSetpoint,endIdxSetpoint))

figure()
plot(poseTime(startIdxPose:endIdxPose),zpose(starIdxPose), hold on
plot(setpointTime(startIdxSetpoint,endIdxSetpoint),zsetpoint(startIdxSetpoint,endIdxSetpoint))
